<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Εθελοντικός Οργανισμός Νεολαίας</title>
  <link rel="stylesheet" href="/main.css" />
</head>
<body>
  <header>
    <h1>Εθελοντικός Οργανισμός Νεολαίας</h1>
    <nav id="main-nav">
      <a href="/main.html">Αρχική</a>
      <a href="/leaderboard.html">Κατάταξη</a>
      <a href="/contact.html">Επικοινωνία</a>
      <a href="/register.html" id="register-link">Εγγραφή</a>
      <a href="/login.html" id="login-link">Σύνδεση</a>
    </nav>
  </header>

  <main>
    <div class="main-container">
      <section>
        <h2>Ποιοι είμαστε</h2>
        <p>Οργανισμός νεολαίας για κοινωνική και περιβαλλοντική δράση σε όλη την Ελλάδα.</p>
      </section>

      <section>
        <h2>Το έργο μας</h2>
        <p>50+ καθαρισμοί παραλιών, 1000+ δέντρα φυτεμένα, 30+ κοινωνικές δράσεις.</p>
      </section>

      <section>
        <h2>Προγραμματισμένες Δραστηριότητες</h2>
        <ul id="event-list"></ul>
      </section>

      <section>
        <h2>Ολοκληρωμένες Δραστηριότητες</h2>
        <ul id="completed-event-list"></ul>
      </section>

      <section>
        <h2>Γίνε Εθελοντής</h2>
        <form id="volunteer-form">
          <label for="username">Όνομα</label>
          <input type="text" id="username" name="username" required />
          <label for="email">Email</label>
          <input type="email" id="email" name="email" required />
          <label for="phone">Τηλέφωνο</label>
          <input type="tel" id="phone" name="phone" />
          <label for="password">Κωδικός</label>
          <input type="password" id="password" name="password" required />
          <button type="submit">Συμμετοχή</button>
        </form>
      </section>
    </div>
  </main>

  <footer>
    <p>Επικοινωνήστε μαζί μας: <a href="mailto:info@volunteer.gr">info@volunteer.gr</a> | © 2025</p>
  </footer>

  <script>
    let userData = null;

    async function loadSessionAndEvents() {
      try {
        const profileRes = await fetch('/profile');
        if (profileRes.ok) {
          const profileData = await profileRes.json();
          userData = profileData.user;

          const loginLink = document.getElementById('login-link');
          if (loginLink) {
            loginLink.textContent = 'Προφίλ';
            loginLink.href = '/profile.html';
          }

          const registerLink = document.getElementById('register-link');
          if (registerLink) registerLink.remove();

          if (!document.getElementById('logout-link')) {
            const nav = document.getElementById('main-nav');
            const logout = document.createElement('a');
            logout.href = '/logout';
            logout.id = 'logout-link';
            logout.textContent = 'Αποσύνδεση';
            nav.appendChild(logout);
          }

          if (userData.role === 'admin' && !document.getElementById('admin-link')) {
            const nav = document.getElementById('main-nav');
            const adminLink = document.createElement('a');
            adminLink.href = '/admin.html';
            adminLink.id = 'admin-link';
            adminLink.textContent = 'Διαχειριστής';
            nav.appendChild(adminLink);
          }
        }
      } catch (e) {
      }

      loadEvents();
    }

    async function toggleParticipation(eventId, button, joined) {
      if (!userData) return window.location.href = '/login.html';
      const url = joined ? `/cancel_participation/${eventId}` : `/participate/${eventId}`;
      const res = await fetch(url, { method: 'POST' });
      const nowJoined = !joined;
      button.textContent = nowJoined ? 'Ακύρωση Συμμετοχής' : 'Συμμετοχή';
      button.onclick = () => toggleParticipation(eventId, button, nowJoined);
    }

    function loadEvents() {
      fetch('/events')
        .then(res => res.json())
        .then(data => {
          const eventList = document.getElementById('event-list');
          const completedList = document.getElementById('completed-event-list');

          data.upcoming.forEach(event => {
            const li = document.createElement('li');
            li.textContent = `${event.name} - ${event.date} - ${event.location}`;
            if (userData) {
              const joined = event.joined === 1;
              const btn = document.createElement('button');
              btn.className = 'event-attend-btn';
              btn.textContent = joined ? 'Ακύρωση Συμμετοχής' : 'Συμμετοχή';
              btn.onclick = () => toggleParticipation(event.id, btn, joined);
              li.appendChild(btn);
            }
            eventList.appendChild(li);
          });

          data.completed.forEach(event => {
            const li = document.createElement('li');
            li.textContent = `${event.name} - ${event.date} - ${event.location}`;
            completedList.appendChild(li);
          });
        });
    }

    document.getElementById('volunteer-form').addEventListener('submit', async e => {
      e.preventDefault();
      const formData = Object.fromEntries(new FormData(e.target).entries());
      const response = await fetch('/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      });
      if (response.ok) window.location.href = '/login.html';
    });

    loadSessionAndEvents();
  </script>
</body>
</html>
